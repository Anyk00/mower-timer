# mower定时器悬浮窗

这是一个用于显示mower下次任务倒计时的悬浮窗应用程序。它可以读取指定的日志文件，提取下次任务时间，并以悬浮窗形式显示倒计时。

## 功能特点

1. 悬浮窗显示倒计时，实时更新（每秒刷新）
2. 当任务正在进行时显示"进行中..."
3. 可自定义悬浮窗的：
   - 字体名称和大小
   - 背景颜色
   - 字体颜色
   - 窗口尺寸和透明度
   - 窗口位置
   - 备注信息及其字体大小和颜色
4. 支持通过设置窗口调整所有参数
5. 可拖动悬浮窗到任意位置
6. 支持高DPI显示器适配

## 安装与运行

### 环境要求

- Python 3.6或更高版本
- Windows操作系统（目前仅支持Windows）

### 运行方法

1. 克隆或下载本项目
2. 安装依赖(如果没有打包需求，请忽略此步骤)：
   ```
   pip install -r requirements.txt
   ```
3. 在项目目录下执行以下命令运行程序：
   ```
   python main.py
   ```
   
### 打包为可执行文件

可以使用PyInstaller将程序打包为独立的exe文件：

```
pyinstaller --noconfirm --onefile --windowed main.py
```

## 使用说明

### 悬浮窗操作

- 点击"×"按钮可关闭悬浮窗
- 点击"⚙"按钮可打开设置窗口
- 可拖动悬浮窗到任意位置

### 配置参数

配置存储在`config.json`文件中，包括：

| 参数 | 描述 | 默认值 |
|------|------|--------|
| log_file_path | 日志文件路径 | ./runtime.log |
| font_name | 字体名称 | Microsoft YaHei |
| font_size | 倒计时字体大小 | 24 |
| background_color | 背景颜色 | #80ff80 (绿色)|
| font_color | 倒计时字体颜色 | #000000 (黑色) |
| remark_font_size | 备注字体大小 | 20 |
| remark_color | 备注字体颜色 | #0000ff (蓝色) |
| window_width | 窗口宽度 | 550 |
| window_height | 窗口高度 | 60 |
| window_x | 窗口X坐标 | 1000 |
| window_y | 窗口Y坐标 | 1000 |
| window_alpha | 窗口透明度 | 1.0 |
| remark | 备注文本 | 账号1 |

### 设置窗口

设置窗口提供了图形化界面来调整所有配置参数：

1. 可以选择不同的字体
2. 可以调整倒计时和备注的字体大小
3. 可以自定义背景色、字体颜色和备注颜色
4. 可以调整窗口大小、位置和透明度
5. 可以设置备注文本
6. 提供"保存设置"、"应用"和"关闭"按钮
   - "保存设置"：应用更改并保存到配置文件，然后关闭窗口
   - "应用"：应用更改但不关闭窗口
   - "关闭"：直接关闭窗口，不保存更改

### 日志文件格式

程序会在日志文件中查找以下格式的下次任务时间：

```
YYYY-MM-DD HH:MM:SS,XXXXXX休息 XX 分钟，到HH:MM:SS开始工作
```

或者

```
YYYY-MM-DD HH:MM:SS,XXXXXX休息 XX 小时 XX 分钟，到HH:MM:SS开始工作
```

只要日志文件中包含以上任一格式的时间信息，程序即可正确解析。

## 自定义

你可以通过以下方式自定义悬浮窗：

1. 直接编辑`config.json`文件
2. 运行`settings.py`打开图形化设置窗口
3. 在悬浮窗运行时点击设置按钮（齿轮图标）

## 注意事项

- 程序启动后会自动创建默认配置文件`config.json`
- 如果指定的日志文件不存在，程序会显示"未找到下次任务时间"
- 悬浮窗始终保持在屏幕最前端
- 程序每5秒检查一次日志文件更新
- 倒计时每秒更新一次
- 设置窗口支持实时预览功能，点击"应用"按钮可即时看到效果
- 程序支持高DPI缩放，在不同分辨率的显示器上都能正常显示

## 使用效果

![alt text](demo.png)